{{ $label                      := (printf "%s" .label) }}
{{ $symbol                     := .symbol }}
{{ $deep                       := .deep }}
{{ $type                       := (printf "%T" .symbol) }}
{{ $typeIsBool                 := (eq "bool" $type) }}
{{ $typeIsNumber               := (or (eq "int" $type) (eq "int64" $type) (eq "float64" $type)) }}
{{ $typeIsString               := (findRE "^(string|template\\.(CSS|HTML|HTMLAttr|JS|JSStr|URL))$" $type) }}
{{ $typeIsTime                 := (eq "time.Time" $type) }}
{{ $typeIsSlice                := (findRE "^([[][]]|.*TaxonomyList|output\\.Formats|resource\\.Resources|.*navigation\\.Menu$|\\*?hugolib\\.Pages$|hugolib\\.OrderedTaxonomy$|hugolib\\.WeightedPages)" $type) }} <!-- match ^[] -->
{{ $typeIsMap                  := (findRE "^(map[[].+[]]|.*SiteSocial|.*navigation\\.Menus$|hugolib\\.AuthorList|hugolib\\.Taxonomy|maps\\.Params)" $type) }} <!-- match ^map[*] -->
{{ $typeIsPage                 := (findRE "^(\\*hugolib\\.Page|.*hugolib\\.pageState)" $type) }}
{{ $value := dict }}
{{ warnf "debug_dumpvar: deep=%v value=%#v" $deep ($value | jsonify) }}
{{ if $deep }}
    {{ warnf "deep is true" }}
{{ else }}
    {{ warnf "deep is false" }}
{{ end }}
{{ if (eq "bool" $type) }}
    {{ $value = dict .label (printf "%v" .symbol) }}
{{ else if $typeIsNumber }}
    {{ $value = dict .label (printf "N%#v" .symbol | htmlUnescape) }}
{{ else if $typeIsString }}
    {{ $value = (dict .label (printf "%v" .symbol | htmlUnescape)) }}
{{ else }}
    {{ with .symbol }}
        {{ $var_names := slice }}
        {{ $var_symbols := slice }}
        {{ if $typeIsSlice }}
            {{ $value = (dict (printf "%s[]" $label) (printf "%#v" $symbol)) }}
        {{ else if $typeIsPage }}
            {{ if $deep }}
                {{ warnf "if deep=true - deep=%v" $deep }}
                {{ $var_names   = (slice "Name" "Title" "Translations" "ResourceType" "Kind" "Section" "Draft" "Type" "Layout" "Permalink" "RelPermalink" "Data") }}
                {{ $var_symbols = (slice .Name  .Title  .Translations  .ResourceType  .Kind  .Section  .Draft  .Type  .Layout  .Permalink  .RelPermalink  .Data ) }}
            {{ else }}
                {{ warnf "if deep=false - deep=%v" $deep }}
                {{ $var_names   = (slice "Name" "Title" "ResourceType" "Kind" "Section" "Draft" "Type" "Layout" "Permalink" "RelPermalink" "Data") }}
                {{ $var_symbols = (slice .Name  .Title  .ResourceType  .Kind  .Section  .Draft  .Type  .Layout  .Permalink  .RelPermalink  .Data ) }}
            {{ end }}
        {{ else if eq "page.Pages" $type }}
            {{ range $symbol }}
                {{ $value = merge $value (partial "debug_dumpvar.html" (dict "label" "page#Pages" "deep" false "symbol" . )) }}
                {{/* $value = merge $value (dict "page-Pages" (printf "%T" .) ) */}}
            {{ end }}
        {{ else }}
            {{ $value = (dict $label (dict "Unhandled type" (printf "%T" $symbol) "Value" (printf "%#v" $symbol))) }}
        {{ end }}

        {{ if gt (len $var_names) 0 }}
            {{ range $i, $var_name := $var_names }}
                {{ $var := (index $var_symbols $i) }}
                {{ $var_type := printf "%T" $var }}
                {{ $var_label := printf "%s (%s)" $var_name $var_type }}
                {{ $value = merge $value (partial "debug_dumpvar.html" (dict "label" $var_label "symbol" $var)) }}
            {{ end }}
        {{ end }}
    {{ end }}
{{ end }}

{{ $value = merge $value (dict (printf "%s-deep-" $label) .deep) }}
{{ return $value }}
